% Document wide customizations
\usepackage[style=phys,
            articletitle=false,
            biblabel=brackets,
            chaptertitle=false,
            pageranges=false,
            url=true,
            hyperref=manual]{biblatex}
\usepackage[en-US,useregional]{datetime2}
\usepackage{etoolbox}
\usepackage{fancyhdr}
\usepackage{import}
\usepackage{kprussing}
\usepackage{listings}
\usepackage{standalone}
\usepackage{titlesec}
\usepackage{titling}
\usepackage{zenburn}
\AtEndPreamble{%
    \usepackage[colorlinks]{hyperref}
    \usepackage[capitalise]{cleveref}
    \BiblatexManualHyperrefOn
}

% Stash if we are using the composite document
\newtoggle{is book}
\makeatletter
\@ifclassloaded{book}{\global\toggletrue{is book}}
                     {\global\togglefalse{is book}}
\makeatother

% Site wide configurations
\renewcommand\familydefault{\sfdefault}
\lstset{upquote=true,
        basicstyle=\small\ttfamily}
\lstdefinestyle{inputs}{%
    style=zenburn,
    emptylines=0,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{\(\hookrightarrow\)}},
}
% We need to adjust the chapter and bibliography for the full document.
\iftoggle{is book}{%
    \titleformat{\chapter}
                [display]
                {\normalfont\Large\bfseries}
                {\chaptertitlename\ \thechapter}
                {0.5ex}
                {\Large}
                [\large\textnormal{\itshape\theauthor}\\
                       \textnormal{\DTMusedate{current}}]
    \titlespacing{\chapter}{0pt}{-50pt}{20pt}
    \ExecuteBibliographyOptions{refsegment=chapter+}
    \newenvironment{summary}{%
        \section*{Abstract}
        \small
        \quotation
    }{\endquotation}
}{%
    \newenvironment{summary}{\abstract}
                            {\endabstract}
}

% Configure the header and footer based on inclusion as a chapter or a
% standalone document
\fancyhf{}
\renewcommand\headrulewidth{0pt}
\pagestyle{fancy}
\iftoggle{is book}{%
    \fancyhead[CE]{\rightmark}
    \fancyhead[CO]{\leftmark}
    \fancyfoot[LE,RO]{\thepage}
    \renewcommand{\chaptermark}[1]{%
        \markboth{\chaptername\ \thechapter.\ #1}{}%
    }
    \renewcommand{\sectionmark}[1]{%
        \markright{\thesection.\ #1}%
    }
}{%
    \fancyhead[C]{\rightmark}
    \fancyfoot[R]{\thepage}
}
\fancyfoot[C]{\theauthor{} \textcopyright{} \DTMfetchyear{current}}
\fancypagestyle{plain}{%
    \fancyhead{}
}

\author{Keith F. Prussing, Ph.D.}
\title{The Keith Page}
%\DTMsavedate{current}{\DTMtoday}

% Local macros for document management
\newcommand\blogtitle[1]{%
    \iftoggle{is book}{%
        \chapter{#1}%
    }{%
        \title{#1}%
    }%
}

% Add the bibliography
\addbibresource{references.bib}
